---
title: "DA410_Project1_MattGraham"
output:
  word_document: default
  html_document:
    df_print: paged
  pdf_document: default
---

This is our first project, analyzing air pollution, mortality rates, and relevant parameters.

#### Getting imports for analysis
```{r Imports, message=FALSE}
library(nnspat)  # used for dist2full()
library("dplyr")  # used to select numeric datatypes
library("ggplot2")
library(reshape)  # used for melting matricies

airpol.full <- read.table("C:/mattgraham93.github.io/school/22_3_DA410/data/airpoll.txt", header=TRUE)

city.names <- as.character(airpol.full[1:16,1])
airpol.data.sub <- airpol.full[1:16,2:8]

airpol.data.sub
```

### 1 - Calculating covariance and correlation

Identify which pairs of variables seem to be strongly associated, and describe the nature (strength and direction) of the relationship between these variable pairs. 

#### Covariance
```{r warning=FALSE}
my.S <- round(var(airpol.data.sub), digits=2)

melted.my.S <- melt(my.S)

ggplot(data = melted.my.S, aes(x=X1, y=X2, fill=value)) + 
  geom_tile() +
  geom_text(aes(label = round(value, 1)))

```

#### Correlation
```{r warning=FALSE}
my.R <- round(cor(airpol.data.sub), digits=2)

melted.my.R <- melt(my.R)

ggplot(data = melted.my.R, aes(x=X1, y=X2, fill=value)) + 
  geom_tile() +
  geom_text(aes(label = round(value, 1)))

```

#### Covariance vs. Correlation
```{r warning=FALSE}
as.data.frame(cov2cor(my.S))
melted.my.cor2cov <- melt(cov2cor(my.S))

ggplot(data = melted.my.cor2cov, aes(x=X1, y=X2, fill=value)) + 
  geom_tile() +
  geom_text(aes(label = round(value, 1)))

```

#### Covariance/correlation analysis
Looking at our correlation plots, a few things really stood out to me. The first being the negative correlation between education and rainfall. There is also a strong positive correlation between NOX and SO2. It would make sense for pollutanats to be holistically more present in places with more pollution versus those without.

We can also see the positive correlation between NOX and SO2 has on mortality rates! Theo only negative correlation is education, which is quite interesting.

### 2 - Calculating weighted distance

Describe some of the most similar pairs of cities and some of the most different pairs of cities, giving evidence from the distance matrix.

```{r warning=FALSE}
std <- sapply(airpol.data.sub, sd) # finding standard deviations of variables
airpol.data.std <- sweep(airpol.data.sub,2,std,FUN="/")  # dividing each variable by its standard deviation
dis <- dist(airpol.data.std) 
dis.matrix<-dist2full(dis) 
rownames(dis.matrix) <- city.names
colnames(dis.matrix) <- city.names

my.melted.dist <- melt(round(dis.matrix,digits=2))

ggplot(data = my.melted.dist, aes(x=X1, y=X2, fill=value)) + 
  geom_tile() +
  geom_text(aes(label = round(value, 1)))

```


#### Distance analysis
We can see that some of the biggest differences are stemming from Chicago, IL. It differs most from other metro areas like Atlanta, GA and even Dallas, TX!

Some of the most similar are among the cities in Ohio - Akron, Canton, Cleveland, and Columbus. 


### 3 - Determining multivariate normality

What is your conclusion based on the plot? 

```{r warning=FALSE}
#Copy the chisplot function into R
chisplot <- function(x) {
  if (!is.matrix(x)) stop("x is not a matrix")
  ### determine dimensions
  n <- nrow(x)
  p <- ncol(x)
  xbar <- apply(x, 2, mean)
  S <- var(x)
  S <- solve(S)
  index <- (1:n)/(n+1)
  xcent <- t(t(x) - xbar)
  di <- apply(xcent, 1, function(x,S) x %*% S %*% x,S)
  quant <- qchisq(index,p)
  plot(quant, sort(di), ylab = "Ordered distances",
  xlab = "Chi-square quantile", lwd=2,pch=1)
}

# Note: You must check if airpol.full has non-numerical columns or not. Use only numerical columns for plot!
chisplot(as.matrix(select_if(airpol.full, is.numeric)))
```

#### Normality analysis
Given the quantile plot above, we can see an exponentially increase in distance from our mean expected value. This implies that mortality is not normal across the United States in cities that were measured!
