---
title: "DA410_Project5_MattGraham"
output:
  html_document:
    df_print: paged
  word_document: default
  pdf_document: default
---

Finding canonical correlationss

```{r Imports, message=FALSE}
library(nnspat)  # used for dist2full()
library("dplyr")  # used to select numeric datatypes
library("ggplot2")
library(reshape)  # used for melting matricies
library(klaR)
library(ggvis)
library(class)
library(gmodels)
library(MASS)
library(readxl)
library(psych)
```


11.10
Get data
```{r}
glucose <- read.table("C:/mattgraham93.github.io/school/22_3_DA410/data/T3_9_GLUCOSE.DAT", header=FALSE)[1:34,]

colnames(glucose) <- c('b_time1', 'b_time2', 'b_time3', 'a_time1', 'a_time2', 'a_time3')  
# b = before, a = after

fasting <- glucose[, 1:3]
post.cons <- glucose[, 4:6]

glucose
```

Find means
```{r}
x.bar <- colMeans(fasting)
y.bar <- colMeans(post.cons)

cbind.data.frame(x.bar, y.bar)
```

### a - Find canonical correlations
```{r}
cancor(y.bar, x.bar)
```
#### Interpretation
Overall, we can see that the centers of before and after consumption are pretty significant. There is slight positive correlation between before and after, however, we can see there is a higher correlation among our post-consumption results.

```{r}
cancor2<-function(x,y,dec=4){ 
#Canonical Correlation Analysis to mimic SAS PROC CANCOR output. 
#Basic formulas can be found in Chapter 10 of Mardia, Kent, and Bibby (1979). 
# The approximate F statistic is exercise 3.7.6b. 
    x<-as.matrix(x)
    y<-as.matrix(y) 
    
    n<-dim(x)[1]
    q1<-dim(x)[2]
    q2<-dim(y)[2]
    q<-min(q1,q2) 
    
    S11<-cov(x)
    S12<-cov(x,y)
    S21<-t(S12)
    S22<-cov(y) 
    
    E1<-eigen(solve(S11)%*%S12%*%solve(S22)%*%S21)
    E2<-eigen(solve(S22)%*%S21%*%solve(S11)%*%S12) 
    
    rsquared<-as.double(E1$values[1:q]) 
    
    LR<-NULL;pp<-NULL;qq<-NULL;tt<-NULL 
    
    for (i in 1:q){ 
        LR<-c(LR,prod(1-rsquared[i:q])) 
        pp<-c(pp,q1-i+1) 
        qq<-c(qq,q2-i+1) 
        tt<-c(tt,n-1-i+1)} 
    
    m<-tt-0.5*(pp+qq+1);lambda<-(1/4)*(pp*qq-2);s<-sqrt((pp^2*qq^2-4)/(pp^2+qq^2-5)) 
    F<-((m*s-2*lambda)/(pp*qq))*((1-LR^(1/s))/LR^(1/s))
    df1<-pp*qq;df2<-(m*s-2*lambda)
    pval<-1-pf(F,df1,df2) 
    outmat<-round(cbind(sqrt(rsquared),rsquared,LR,F,df1,df2,pval),dec) 
      
    colnames(outmat) <- list("R","RSquared","LR","ApproxF","NumDF","DenDF","pvalue")
    rownames(outmat) <- as.character(1:q)
    xrels<-round(cor(x,x%*%E1$vectors)[,1:q],dec) 
    colnames(xrels)<-apply(cbind(rep("U",q),as.character(1:q)),1,paste,collapse="")
    yrels<-round(cor(y,y%*%E2$vectors)[,1:q],dec) 
    colnames(yrels)<- apply(cbind(rep("V",q),as.character(1:q)),1,paste,collapse="")
    list(Summary=outmat,
         a.Coefficients=E1$vectors,
         b.Coefficients=E2$vectors, 
         XUCorrelations=xrels,YVCorrelations=yrels
     ) 
   }  
## END FUNCTION 
################################################# 
```


### b - Find standard coefficients
For canonical variables

Fasting coefficients
```{r}
before.coefficients <- cancor2(fasting, post.cons)$a.Coefficients
after.coefficients <- cancor2(fasting, post.cons)$b.Coefficients

diag(before.coefficients)
```
Post-consumption coefficients
```{r}
diag(after.coefficients)
```

### c - Test significance for reach canonical correlation
```{r}
 
cancor2(fasting, post.cons) 
 
# It produces two other pieces of information:  An F-test for the  
# significance of each canonical correlation, and the correlations between  
# the original variables and the corresponding canonical variates. 
```

#### Interpretation
Given all our p-values > 0.05, there is not enough evidence to conclude that there is at least one non-zero canonical correlation.